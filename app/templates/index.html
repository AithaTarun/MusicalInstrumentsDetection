<!DOCTYPE html>
<html lang="en" class="m-0 h-100">

<head>
    <meta charset="UTF-8">
    <title>Musical Instrument Classification</title>

    <link rel="icon" type="image/x-icon" href="{{url_for('static', filename='favicon.png')}}">

    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='bootstrap.min.css')}}">
</head>

<body class="h-100 m-0">

    <div class="h-100 d-flex justify-content-center align-items-center"
         style="background-image: url({{url_for('static', filename='background.jpg')}});
                background-repeat: no-repeat; background-size: cover;
                background-position: center">

        <div class="row w-100 d-flex justify-content-center">

            <div class="col col-9 col-lg-6">

                <div class="card text-center border-info rounded">
                    <div class="card-header fw-bold border-info" style="font-size: 20px">
                        Upload Your Audio File Here
                    </div>

                    <form action="{{url_for('predict')}}" method="post" enctype="multipart/form-data">

                        <div class="card-body d-flex flex-column justify-content-center align-items-center text-info border-info">
                            <input class="form-control m-2" type="file" id="audioFileInput" accept="audio/x-wav" name="audioFileInput"
                                   onchange="fileChanged()">

                            <audio id="audioHolder" controls class="m-3">
                                <source src="" id="audioSource" />
                            </audio>
                        </div>

                        <div class="card-footer border-info">
                            <button class="btn btn-info text-white" type="submit">
                                Predict
                            </button>
                        </div>

                    </form>

                </div>

                <!-- Showing Predictions -->
                <div class="my-4">
                    <div class="row w-100 d-flex justify-content-between m-0">

                        {% for instrument in predictions[0] %}
                            <div class="col col-5 col-lg-4">
                                <div class="card text-center rounded" style="color: #ffffff; background-color: RGBA(250, 250, 250, var(--bs-bg-opacity,1))">

                                    <div class="card-header text-primary fw-bold" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis">
                                        {{predictions[2][loop.index0]}} - {{'%0.2f' | format(predictions[1][loop.index0] * 100 | round)}} %
                                    </div>

                                   <div class="card-body">
                                       <img src="{{url_for('static', filename='instruments/' + instrument + '.png')}}"
                                            alt="" style="width: 128px; height: 128px">
                                   </div>

                                </div>
                            </div>
                        {% endfor %}

                    </div>
                </div>

            </div>

        </div>

    </div>

    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='bootstrap.bundle.min.js')}}">

    <script>
        const audioFileInput = document.querySelector("#audioFileInput");

        const audioSource = document.querySelector("#audioSource");
        const audioHolder = document.querySelector("#audioHolder");

        const fileChanged = ()=>
        {
            audioSource.setAttribute('src', URL.createObjectURL(audioFileInput.files[0]));

            audioHolder.load();
        }
    </script>
</body>

</html>
